import{r as p,u as x,j as s,c as y,F as L,H as F,I as R,b as H,J as $,f as I,K as U,M as B}from"./index-MxhU03Yg.js";import{z as b,u as D,t as q,I as A}from"./index-1_vGLmUA.js";import{R as T}from"./Row-yB_iWEBq.js";import{C as z}from"./Col-8Xz5nKpD.js";import{A as O,u as Y}from"./Anchor-JWMG4twh.js";import{g as _,u as J,C as K,F as k}from"./CloseButton-PzVdL2vS.js";import{F as M,a as V,S as W}from"./Spinner-B5LmHHC6.js";import"./index-BO4lXEiD.js";const C=_("h4");C.displayName="DivStyledAsH4";const S=p.forwardRef(({className:t,bsPrefix:e,as:l=C,...r},a)=>(e=x(e,"alert-heading"),s.jsx(l,{ref:a,className:y(t,e),...r})));S.displayName="AlertHeading";const G=S,N=p.forwardRef(({className:t,bsPrefix:e,as:l=O,...r},a)=>(e=x(e,"alert-link"),s.jsx(l,{ref:a,className:y(t,e),...r})));N.displayName="AlertLink";const Q=N,P=p.forwardRef((t,e)=>{const{bsPrefix:l,show:r=!0,closeLabel:a="Close alert",closeVariant:u,className:n,children:i,variant:c="primary",onClose:o,dismissible:d,transition:g=k,...m}=Y(t,{show:"onClose"}),h=x(l,"alert"),f=J(E=>{o&&o(!1,E)}),w=g===!0?k:g,j=s.jsxs("div",{role:"alert",...w?void 0:m,ref:e,className:y(n,h,c&&`${h}-${c}`,d&&`${h}-dismissible`),children:[d&&s.jsx(K,{onClick:f,"aria-label":a,variant:u}),i]});return w?s.jsx(w,{unmountOnExit:!0,...m,ref:void 0,in:r,children:j}):r?j:null});P.displayName="Alert";const v=Object.assign(P,{Link:Q,Heading:G}),X=b.object({email:b.string().nonempty({message:"Email is Required"}).email().regex(/^[\w-\.]+@([\w-]+\.)+[\w-]{3}$/g),password:b.string().nonempty({message:"Password is required"})}),Z=()=>{const[t,e]=p.useState("idle");return{status:t,setStatus:e,checkPassword:async(r,a)=>{const u=L(),n=F(u,"users");e("checking");try{if(!navigator.onLine)throw new Error("No internet connection");const i=await R(n);if(i.exists()){const c=i.val();let o=!1,d=!1;for(const g in c){const m=c[g];if(m.email===r)if(o=!0,m.password===a){d=!0,e("available");break}else{e("errorPassword");break}}o?d||e("errorPassword"):e("notAvailable")}else e("notAvailable")}catch{e("failed")}}}},ee=()=>{const{register:t,handleSubmit:e,formState:{errors:l}}=D({mode:"onBlur",resolver:q(X)}),r=H(),{status:a,checkPassword:u,setStatus:n}=Z(),[i,c]=$(),o=I(),d=async m=>{o(B(m)),i.get("message")&&c(""),n("idle");const{email:h,password:f}=m;await u(h,f)};p.useEffect(()=>{a==="available"&&r("/")},[a,r]);const g=async m=>{m.target.value===""&&n("idle")};return p.useEffect(()=>()=>{o(U())},[o]),{searchParams:i,handleSubmit:e,onSubmit:d,register:t,errors:l,handleChange:g,status:a}},ce=()=>{var i,c,o,d;const{searchParams:t,handleSubmit:e,onSubmit:l,register:r,errors:a,handleChange:u,status:n}=ee();return s.jsx(s.Fragment,{children:s.jsx(T,{className:"global pt-5",children:s.jsxs(z,{md:{span:6,offset:3},children:[t.get("message")==="created_account"&&s.jsx(v,{variant:"success",children:"Your account has been successfully created, please login."}),t.get("message")==="login_required"&&s.jsx(v,{variant:"success",children:"You have logged out successfully. Please log in again to continue."}),s.jsxs(M,{onSubmit:e(l),children:[s.jsx(A,{label:"Email address",type:"email",name:"email",register:r,error:n==="notAvailable"&&!((i=a.email)!=null&&i.message)?"The email is invalid!":(c=a.email)==null?void 0:c.message,placeholder:"Enter email"}),s.jsx(A,{label:"Password",type:"password",name:"password",register:r,placeholder:"Password",error:(o=a.password)!=null&&o.message?(d=a.password)==null?void 0:d.message:n==="errorPassword"?"The password you entered is incorrect. Please try again.":"",onChange:u}),s.jsx(V,{variant:"primary",type:"submit",disabled:n==="checking",children:n==="checking"?s.jsxs(s.Fragment,{children:[s.jsx(W,{animation:"border",size:"sm"})," Loading..."]}):"Submit"}),n==="failed"&&s.jsx(v,{className:"mt-2",variant:"danger",children:"Unexpected Error, please try again."})]})]})})})};export{ce as default};
