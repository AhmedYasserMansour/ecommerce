import{r as E,F as P,H as C,I as R,b as F,Q as B,S as q,T as A,U as D,j as s,C as H}from"./index-GO7BPj8W.js";import{z as u,u as I,t as L,I as h}from"./index-SJFNufU4.js";import{R as T}from"./Row-bcx-6aBi.js";import{C as U}from"./Col-TQSzdsVT.js";import{F as O,a as $,S as z}from"./Spinner-vqmojlhI.js";import"./index-6F9jWL4p.js";const M=u.object({firstName:u.string().min(2,{message:"First Name is Required"}),lastName:u.string().min(2,{message:"Last Name is Required"}),email:u.string().min(2,{message:"Email is Required"}).email().refine(t=>/^[\w-\.]+[0-9]+@([\w-]+\.)+[\w-]{3}$/g.test(t),{message:"Email must contain both letters and numbers before the @ symbol"}),password:u.string().nonempty({message:"Password is required"}).min(8,{message:"Password Must be 8 or more characters long"}).regex(/.*[^\w\s]|_.*/,{message:"Password must contain at least one special character"}),confirmPassword:u.string().min(2,{message:"Confirm Password is Required"})}).refine(t=>t.password===t.confirmPassword,{message:"Password and Confirm Password does not match",path:["confirmPassword"]}),_=()=>{const[t,r]=E.useState("idle"),[g,a]=E.useState(null);return{status:t,setStatus:r,enteredEmail:g,checkEmail:async e=>{r("checking"),a(e);const n=P(),o=C(n,"users");try{const l=await R(o);if(l.exists()){const m=l.val();for(const c in m)if(m[c].email===e)return r("notAvailable"),!0;return r("available"),!1}else return r("available"),!1}catch{r("failed")}},resetCheckEmail:()=>{r("idle"),a(null)},setEnteredEmail:a}},Q=()=>{const{register:t,handleSubmit:r,formState:{errors:g},getFieldState:a,trigger:i,reset:p}=I({mode:"onBlur",resolver:L(M)}),{status:e,enteredEmail:n,checkEmail:o,resetCheckEmail:l,setStatus:m}=_(),c=F(),b=async x=>{m("loading");const{email:d,password:f,firstName:w,lastName:S}=x;e==="idle"&&o(d);try{const v=(await B(q,d,f)).user;await A(v);const j=P(),k=C(j,"users/"+v.uid);await D(k,{email:d,password:f,name:`${w} ${S}`}),m("idle"),p(),c("/login?message=created_account")}catch(y){console.error("Error registering user:",y)}},N=E.useMemo(()=>e==="checking"||e==="loading"||e==="notAvailable",[e]);return{handleSubmit:r,onSubmit:b,emailOnBlurHandler:async x=>{const d=x.target.value;if(n!==d){await i("email");const{isDirty:f,invalid:w}=a("email");o(d),f&&!w&&n!==d&&o(d),f&&w&&n&&l()}},errors:g,register:t,isDisabled:N,status:e}},Z=()=>{var n,o,l,m,c,b;const{handleSubmit:t,onSubmit:r,emailOnBlurHandler:g,errors:a,register:i,isDisabled:p,status:e}=Q();return s.jsx(H,{className:"p-5",children:s.jsx(T,{children:s.jsx(U,{md:{span:6,offset:3},children:s.jsxs(O,{onSubmit:t(r),autoComplete:"off",children:[s.jsx(h,{label:"First Name",type:"text",name:"firstName",register:i,error:(n=a.firstName)==null?void 0:n.message,placeholder:"First Name"}),s.jsx(h,{label:"Last Name",type:"text",name:"lastName",register:i,error:(o=a.lastName)==null?void 0:o.message,placeholder:"Last Name"}),s.jsx(h,{label:"Email address",type:"email",name:"email",register:i,error:(l=a.email)!=null&&l.message?(m=a.email)==null?void 0:m.message:e==="notAvailable"?"The email address is already in use. Please try a different email address.":e==="failed"?"Error from the Server.":"",onBlur:g,placeholder:"Enter email",success:e==="available"?"The email address is available and can be used.":"",formText:e==="checking"?"Checking email availability, please wait...":"",disabled:e==="checking"||e==="loading"}),s.jsx(h,{label:"Password",type:"password",name:"password",register:i,error:(c=a.password)==null?void 0:c.message,placeholder:"Password"}),s.jsx(h,{label:"Confirm Password",type:"password",name:"confirmPassword",register:i,error:(b=a.confirmPassword)==null?void 0:b.message,placeholder:"Confirm Password"}),s.jsx($,{variant:"primary",type:"submit",disabled:p,children:e==="loading"?s.jsxs(s.Fragment,{children:[s.jsx(z,{animation:"border",size:"sm"})," Loading..."]}):"Submit"})]})})})})};export{Z as default};
